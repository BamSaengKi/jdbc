import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class yas {

	public static void main(String[] args) {
		DBConnection dbConn = new DBConnection();
		
		dbConn.connect();
		
		UserDTO userinfo = new UserDTO("야스ㅓ", "yas", "seeex", 29, "울산");
			
		dbConn.createUser(userinfo);
		dbConn.close();	
	}

}


class DBConnection {
	Connection connection;
	public void connect() { 
		String url = "jdbc:mysql://localhost:3306/user_management?serverTimezone=UTC";
		String user = "root";
		String password = "785643";
		String driverName = "com.mysql.cj.jdbc.Driver";
		
		try {
			Class.forName(driverName);
			connection = DriverManager.getConnection(url, user, password);
			System.out.println(connection.getMetaData());
		} catch (ClassNotFoundException e) {
			System.out.println("[로드 오류]\n" + e.getStackTrace());
		}catch(SQLException e) {
			System.out.println("연결 오류]\n" + e.getStackTrace());
		}
	}

	public int createUser(UserDTO userDto) {
		int id = -1;
		
		PreparedStatement statement = null;
		
		ResultSet rs = null;
		
		String sql = "INSERT INTO t_user (user_name, user_login_id, user_login_pw, user_age, user_location)VALUES(?,?,?,?,?);";
	

		try {
            statement = connection.prepareStatement(sql, PreparedStatement.RETURN_GENERATED_KEYS);
            statement.setString(1, userDto.getUser_name());
            statement.setString(2, userDto.getUser_login_id());
            statement.setString(3, userDto.getUser_login_pw());
            statement.setInt(4, userDto.getUser_age());
            statement.setString(5, userDto.getUser_location());
			statement.executeUpdate();
			rs = statement.getGeneratedKeys();
			if (rs.next()) {
				id = rs.getInt(1);
			}
		} catch (SQLException e) {
			System.out.println(e.getMessage());
			System.out.println("[INSERT 쿼리 오류]\n" + e.getStackTrace());
		}

		try {
			if (statement != null) {
				statement.close();
			}

			if (rs != null) {
				rs.close();
			}
		} catch (SQLException e) {
			System.out.println("[INSERT 종료 오류]\n" + e.getStackTrace());
		}

		return id;
	}

	public void close() {
		try {
			if (connection != null) {
				connection.close();
			}
		} catch (SQLException e) {
			System.out.println("[닫기 오류]\n" + e.getStackTrace());
		}
	}
}
	